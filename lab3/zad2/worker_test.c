#include "../../../../Unity/src/unity.h"
#include "matrix_worker.h"

void setUp(void) {
}

void tearDown(void) {
}

void test_cmp_matrices(void){
    const int n_rows = 20;
    const int n_cols = 30;

    Matrix *first = malloc(sizeof(Matrix));
    first->matrix = malloc(n_rows * sizeof(int *));
    
    Matrix *second = malloc(sizeof(Matrix));
    second->matrix = malloc(n_rows * sizeof(int *));

    for(int r = 0; r < n_rows; r++){
        first->matrix[r] = malloc(n_cols * sizeof(int));
        second->matrix[r] = malloc(n_cols * sizeof(int));

        for(int c = 0; c < n_cols; c++){
            first->matrix[r][c] = second->matrix[r][c] = r*n_cols + c - 20;
        }
    }

    first->n_cols = second->n_cols = n_cols;
    first->n_rows = second->n_rows = n_rows;

    TEST_ASSERT_TRUE(cmp_matrices(first, second));
    first->matrix[n_rows-1][n_cols-1] = 2137;
    TEST_ASSERT_FALSE(cmp_matrices(first, second));

    free_matrix(first);
    free_matrix(second);
}

void test_multiply_matrices(void){
    int a[19][12]={
            {-2, -5, -49, -37, -33, 74, -46, 16, 10, 98, -78, -78},
            {41, 10, -6, 21, 80, 46, -11, 88, -2, -45, -50, -57},
            {12, 39, -56, 90, -45, 11, -40, 3, -95, 11, 66, -77},
            {-65, 70, -11, 45, 17, 11, 18, -43, 71, -89, 79, 0},
            {8, -33, -63, 56, -27, -12, 100, 85, 77, 94, 25, -69},
            {4, 85, 34, -41, -54, -51, -68, -19, -82, 21, 76, 35},
            {82, -7, 92, 52, -45, 20, -48, 63, 88, -11, 18, -90},
            {27, -33, 95, 3, -40, -31, 34, 14, -46, -33, 24, -50},
            {-34, 56, 31, -16, -73, 6, -82, -92, 50, 61, 11, -96},
            {-20, 63, 67, -83, -49, -66, -73, 29, -48, 73, -69, -38},
            {92, 16, 77, -55, 33, -50, -5, 100, 56, 76, -17, 83},
            {-68, -48, 42, 82, -88, -48, 86, -8, 65, 2, -40, 66},
            {-14, -63, -6, 38, -91, -24, 51, -99, 92, 27, 97, 24},
            {27, -58, 23, -18, 68, 57, -85, 100, -92, 57, 81, 71},
            {59, 66, -38, 23, -83, -28, -62, 4, 10, 33, -59, 19},
            {-92, 92, -30, 50, -32, -83, -27, 95, -91, 47, -73, 77},
            {-47, -58, 77, -39, 49, 57, -69, 7, -27, -57, 80, -10},
            {16, -83, 94, -75, 0, 86, -6, -42, 27, 15, -93, 46},
            {-18, -69, -10, -9, 78, 17, -33, -70, 59, -57, -59, -43}
    };

    int b[13][19]={
            {-63, -90, 0, 97, 45, 12, 51, -89, 17, 22, 63, -72, 8, 19, -43, 8, 77, 54, -28},
            {81, -15, -33, -53, -99, -64, 8, 93, 34, 41, 7, 9, 79, 17, 59, 25, -89, -30, -25},
            {-77, 37, 47, 36, 65, -46, -45, 72, 13, 82, 25, 85, 13, -90, -98, 60, -89, 89, -33},
            {55, 23, -92, -39, 82, 37, 29, 40, -39, 40, 60, -13, 13, -54, -67, -51, -89, -12, -46},
            {83, -100, 86, 8, 35, -2, -32, 37, -92, -71, 26, -25, 84, 99, -67, -55, 80, 20, 24},
            {-31, 82, -87, 79, -32, -23, -76, -49, -24, -65, 39, -20, 69, -11, -35, -74, -76, 14, -56},
            {11, -28, -27, -64, -3, -43, -66, -19, -48, 64, -100, 26, -68, 82, 39, -90, 100, 66, 86},
            {-49, 92, -80, 40, -29, 39, -71, -13, 15, -47, 51, 59, 14, -78, -68, 51, 19, -11, 35},
            {100, -9, -1, 51, -84, -19, -18, 5, -58, -18, -29, -73, -17, -38, 98, -78, -16, 37, -99},
            {71, -49, -96, 21, -90, 19, -7, 93, -81, 62, -69, 54, 12, 22, -98, -38, 38, -66, 44},
            {93, -24, 76, -87, 3, -92, -74, 0, -69, 10, -64, 83, -70, -62, 88, 1, 99, 6, 94},
            {91, -25, 55, 72, -72, -84, -7, 82, -22, 81, 66, 73, 23, -59, -2, 37, 44, 7, 63},
            {94, -12, -28, 81, -30, 2, -82, -93, -98, 67, 13, 46, 7, 38, -50, -22, 17, -33, 21}
    };

    int c[13][12] = {
            {-3131,4398,13266,-9676,7492,3836,-9133,342,11699,1661,25432,9486},
            {7134,2925,4404,-3237,-24333,-9929,-5610,-5671,-891,17049,-18951,-614},
            {-14790,2711,10575,11412,-15774,-20971,35737,1161,8286,3310,-18268,1037},
            {17374,-2996,6088,-11786,-5215,-9262,23222,15112,18612,18915,-10665,-7550},
            {2265,-36304,-2961,-414,10104,21261,5939,-2707,-6841,3865,37573,5812},
            {4690,-5210,-9412,-3627,18465,6861,26200,-12613,24062,-14702,7274,20151},
            {-5516,-33229,5443,-22398,21452,24785,-13684,-8969,-13898,-7616,-14464,340},
            {-17534,3148,4251,-224,14443,-11061,17379,-7092,12780,-19759,-6261,18849},
            {13939,9972,-9109,-11367,-3802,17351,-7138,-10604,-4795,-5756,-6813,-2813},
            {-17375,-17638,16645,-13904,7307,-355,3968,-12631,-7997,-19472,5463,2513},
            {-12244,-18294,-17881,5045,461,10331,122,-4702,-10187,-3624,-35102,-11184},
            {-12790,-1753,14425,509,-9401,-5584,-1184,-6169,8131,-4251,-18724,-5673},
            {-17391,-2141,-12505,-10891,16211,4332,2213,568,-1896,431,-2746,18286}
    };
    Matrix *first = malloc(sizeof(Matrix));
    first->n_rows = 19;
    first->n_cols = 12;
    int **a_ptr=malloc(first->n_rows * sizeof(int *));
    for(int r = 0; r<first->n_rows; r++){
        a_ptr[r] = malloc(first->n_cols * sizeof(int));
        for(int c = 0; c<first->n_cols; c++)
            a_ptr[r][c] = a[r][c];
    }
    first->matrix = a_ptr;

    Matrix *second = malloc(sizeof(Matrix));
    second->n_rows = 13;
    second->n_cols = 19;
    int **b_ptr=malloc(second->n_rows * sizeof(int *));
    for(int r = 0; r<second->n_rows; r++){
        b_ptr[r] = malloc(second->n_cols * sizeof(int));
        for(int c = 0; c<second->n_cols; c++)
            b_ptr[r][c] = b[r][c];
    }
    second->matrix = b_ptr;

    // first->n_cols == second->n_rows
    Matrix *result = multiply_matrices(second,first);

    Matrix *c_mat = malloc(sizeof(Matrix));
    c_mat->n_rows = 13;
    c_mat->n_cols = 12;
    int **c_ptr=malloc(c_mat->n_rows * sizeof(int *));
    for(int r = 0; r<c_mat->n_rows; r++){
        c_ptr[r] = malloc(c_mat->n_cols * sizeof(int));
        for(int l = 0; l<c_mat->n_cols; l++)
            c_ptr[r][l] = c[r][l];
    }
    c_mat->matrix = c_ptr;

    TEST_ASSERT_TRUE(cmp_matrices(c_mat,result));
    
    free_matrix(first);
    free_matrix(second);
    free_matrix(result);
    free_matrix(c_mat);
}

int main(void){
    UNITY_BEGIN();
    RUN_TEST(test_cmp_matrices);
    RUN_TEST(test_multiply_matrices);
    return UNITY_END();
}